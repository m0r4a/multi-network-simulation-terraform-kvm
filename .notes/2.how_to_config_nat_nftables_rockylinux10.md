# Crea una tabla para el natting

Por defecto Rocky Linux 10 usa nftables como su firewall, lo puedes activar con:

```bash
sudo systemctl enable --now nftables
```

Aquí los archivos de `nftables` están en `/etc/nftables/*`

## Creando la regla de natting

Crea un archivo .nft en la ruta `/etc/nftables/*`, por ejemplo, `/etc/nftables/10-nat.nft`

El contenido del archivo debe ser algo así:

```
table ip nat {
  chain POSTROUTING {
    type nat hook postrouting priority 100;
    oifname "<la interfaz de salida a internet>" masquerade
  }
}
```

## Activando la regla de natting

Ahora, puedes cargar directamente la regla con `nft -f /etc/nftables/<algo>.nft` pero en un reinicio tanto del servidor como simplemente del servicio se desactivará y tendrás que hacerlo manualmente cada vez.

Para eso, puedes buscar **cuál es el .nft que nftables utiliza al iniciar**, se puede ver con `systemctl cat nftables`, dentro de:

```
[Service]
...
...
Execstart=/sbin/nft -f <ruta a un .conf]
```

cuál es el archivo que se ejectua cada vez que nftables inica.

### Modificando el .conf

En Rocky Linux 10 por defecto es el `/etc/sysconfig/nftables.conf`, así que entras al achivo y agregas la siguiente línea en algúna parte del archivo:

```
include "/etc/nftables/<algo>.nft"
```

Siendo ese `<algo>`, por ejemplo, `10-nat.nft`

Solo queda queda reiniciar el servicio:

```bash
sudo systemctl restart nftables.service
```

Y natting queda configurado.

# Permitiendo el reenvío de IPv4

Ahora solo falta que el kernel permita reenviar paquetes entre interfaces de red. Por defecto, Linux tiene deshabilitado el IP forwarding por seguridad.

```bash
echo 'net.ipv4.ip_forward = 1' | sudo tee /etc/sysctl.d/99-ipfwd.conf
sudo sysctl --system
```
